import net.postgis.jdbc.geometry.Point;

-- 4326 is the SRID for WGS 84
CREATE TABLE locations (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  point GEOMETRY(Point, 4326) AS Point NOT NULL
);

insertMakePoint:
INSERT INTO locations (name, point)
VALUES ('New York', ST_MakePoint(:x::REAL, :y::REAL));

insertMakePointM:
INSERT INTO locations (name, point)
VALUES ('New York', ST_SetSRID(ST_FORCE2D(ST_MakePointM(:x::REAL, :y::REAL, :m::REAL)), :srid::INTEGER));

insertPoint:
INSERT INTO locations (name, point)
VALUES ('New York', ST_SetSRID(ST_Point(:x::REAL, :y::REAL), :srid::INTEGER));

insertPointZ:
INSERT INTO locations (name, point)
VALUES ('New York', ST_SetSRID(ST_FORCE2D(ST_PointZ(:x::REAL, :y::REAL, :z::REAL)), :srid::INTEGER));

insertPointM:
INSERT INTO locations (name, point)
VALUES ('New York', ST_SetSRID(ST_FORCE2D(ST_PointM(:x::REAL, :y::REAL, :m::REAL)), :srid::INTEGER));

insertPointZM:
INSERT INTO locations (name, point)
VALUES ('New York', ST_SetSRID(ST_FORCE2D(ST_PointZM(:x::REAL, :y::REAL, :z::REAL, :m::REAL)), :srid::INTEGER));

selectWithin:
SELECT ST_DWithin(
  ST_GeographyFromText('SRID=4326;POINT(13.405 52.52)'),
  ST_GeographyFromText('SRID=4326;POINT(19.945 50.0647)'),
  :distanceMeters::REAL,
  :useSpheroid::BOOLEAN
);

select:
SELECT *
FROM locations;

selectPoints:
SELECT point
FROM locations;

selectLocationByDistance:
SELECT id, name
FROM locations
WHERE ST_DWithin(point::geography, :geometry::geometry, :distanceMeters::REAL, :useSpheroid::BOOLEAN);

selectLocationByDistanceHardcoded:
SELECT id, name
FROM locations
WHERE ST_DWithin(point::geography, ST_GeographyFromText('SRID=4326;POINT(-74.0060 40.7128)'), :distanceMeters::REAL);
