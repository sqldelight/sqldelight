apply plugin: "com.vanniktech.maven.publish"

mavenPublish {
  // can be set to false after upgrading to AGP 3.6.0
  useLegacyMode = true

  targets {
    installArchives {
      releaseRepositoryUrl = "file://${rootProject.buildDir}/localMaven"
      snapshotRepositoryUrl = "file://${rootProject.buildDir}/localMaven"
    }
  }
}

def isReleaseBuild() {
  return VERSION_NAME.contains("SNAPSHOT") == false
}

def getGpgKey() {
  return hasProperty('signingKey') ? signingKey : ""
}

afterEvaluate {
  signing {
    required { isReleaseBuild() && !getGpgKey().isEmpty() }

    def signingKey = getGpgKey()
    if (!signingKey.isEmpty() && isReleaseBuild()) {
      useInMemoryPgpKeys(signingKey, "")
    }
  }
}
